<!doctype html>
<html>

<head>
    <title>Meow Cat</title>
    <style>
        button,
        canvas {
            display: block;
            margin: auto;
        }

        html {
            background-color: gold;
        }

    </style>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <button onclick='startPos()'>Play Again</button>
    <script>
        var canvas, canvasContext, imgAssets;
        var username = '';
        while(username == '' || username == null) {
            username = prompt('What is your name?') || '';
        }
        
        var dogNull = '';
        while(dogNull == '' || dogNull == null) {
            dogNull = prompt('How many dogs are you wanting?') || '';
            
        }
        var dogLove = dogNull;
        
        

        function playagain() {
            console.log('worked');
        }
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            imgAssets = loadImgAssets();

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);


            setInterval(mainLoop, 1000 / 50);
        }
       
        /* player info */
        var playerXpos = 0;
        var playerYpos = 0;
        const PLAYER_WIDTH = 50;
        const PLAYER_HEIGHT = 30;
        var playerXspeed = 10;

        /* doginfo */
        var dogXpos = 150;
        var dogYpos = 0;
        const DOG_WIDTH = 40;
        const DOG_HEIGHT = 30;
        var dogYspeed = 6;
        var dogXspeed = 6;
        var lives = 6;

        var dogs = [];
        var lives = 3;

        /* player keyPressing */
        const LEFT_ARROW_KEY = 37;
        const RIGHT_ARROW_KEY = 39;
        var leftArrowKeyPressed = false;
        var rightArrowKeyPressed = false;

        var startingPos = true; // toggle starting positions


        var score = 0;


        var dogs = [];
        var dogTotal = dogLove;

        var gameRunning = true;

        function mainLoop() {
            colorRect(0, 0, canvas.width, canvas.height, 'black') // background
            //            colorRect(playerXpos, playerYpos, PLAYER_WIDTH, PLAYER_HEIGHT, 'green') //player
            if (gameRunning) {

                drawingImages(img.player, playerXpos, playerYpos, PLAYER_WIDTH, PLAYER_HEIGHT);
                //            colorRect(dogXpos, dogYpos, DOG_WIDTH, DOG_HEIGHT, 'green') //block
                textRender('Lives: ' + lives, 'white', 15, 25, '20px Arial');
                textRender('Score: ' + score, 'white', canvas.width - 100, 25, '20px Arial');



                if (startingPos) {
                    startPos();
                    startingPos = false;

                }



                playerMove();
                dogMove();
                drawBlocks();
                collision();
            }
            else {
                console.log('score is :' + score)
                textRender('Gameover '+ username + ', your score was: ' + score, 'white', 15, 25, '20px Arial');
            }




        }

        function randomBlock() {
            var dogSize = Math.floor(Math.random() * (40 - 15) + 15) // get rand num between 2 values     
            var newBlockRand = {
                dogSize: dogSize,
                dogXpos: Math.floor(Math.random() * (400 - dogSize - 0)) + 0,
                dogYpos: Math.floor(Math.random() * (canvas.height*.6 - dogSize - 0)) + 0,
                dogXspeed: Math.floor(Math.random() * (5 - 0)) + 1,
                dogYspeed: Math.floor(Math.random() * (5 - 0)) + 1,
            }
            return newBlockRand
        }

        function drawBlocks() {
            dogs.forEach(function(block, index) {
                drawingImages(img.dog, block.dogXpos, block.dogYpos, block.dogSize, block.dogSize);

            });
        }

        function collision() {
            if (playerYpos + PLAYER_HEIGHT, PLAYER_WIDTH > dogYpos && playerYpos < dogYpos + DOG_HEIGHT, DOG_WIDTH &&
                playerXpos + PLAYER_HEIGHT, PLAYER_WIDTH > dogXpos && playerYpos < dogXpos + DOG_HEIGHT, DOG_WIDTH
            ) {
                starting = true;
            }
        }

        function loadImgAssets() {
            img = {};
            img.player = new Image();
            img.player.src = 'Image/catd.png'
            img.dog = new Image();
            img.dog.src = 'Image/dog.png'



            return img;
        }

        function keyPressed(evt) {
            console.log(evt.keyCode)
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = true;
            }
        }


        function keyReleased(evt) {
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = false;
            }
        }

        function colorRect(x, y, w, h, color) {
            canvasContext.fillStyle = color;
            canvasContext.fillRect(x, y, w, h);
        }



        function startPos() {
            playerXpos = canvas.width / 2 - PLAYER_WIDTH / 2;
            playerYpos = canvas.height - PLAYER_HEIGHT;
            lives = 4;
            score = 0;
            gameRunning = true;
            
            if (dogs.length < 1) {

                for (i = 0; i < dogTotal; i++) {
                    dogs.push(randomBlock());
                }
            
                if (dogs.length > 0) {

                for (i = 0; i < dogTotal; i++) {
                    dogs.push(randomBlock());
                }
            
            }
        
        

           



        function playerMove() {

            if (leftArrowKeyPressed) {
                if(playerXpos < 0){
                   playerXpos = canvas.width - PLAYER_WIDTH;
                }
                playerXpos -= playerXspeed;
            }
            if (rightArrowKeyPressed ) {
                if(playerXpos > canvas.width - PLAYER_WIDTH){
                   playerXpos = 0;
                   }
                playerXpos += playerXspeed;
            }
        }

        function drawingImages(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        }

        function dogMove() {
            dogs.forEach(function(dog, index) {
                dog.dogYpos += dog.dogYspeed;
                dog.dogXpos += dog.dogXspeed;
                if (dog.dogXpos > canvas.width - dog.dogSize) {
                    dog.dogXspeed *= -1;
                }
                if (dog.dogXpos < 0) {
                    dog.dogXspeed *= -1;
                }
                if (dog.dogYpos > canvas.height - dog.dogSize) {
                    dog.dogYspeed *= -1;
                    score++;
                }
                if (dog.dogYpos < 0) {
                    dog.dogYspeed *= -1;
                }
                if (
                    playerXpos + PLAYER_WIDTH > dog.dogXpos &&
                    playerXpos < dog.dogXpos + dog.dogSize &&
                    playerYpos + PLAYER_HEIGHT > dog.dogYpos &&
                    playerYpos < dog.dogYpos + dog.dogSize
                ) {
                    lives--;
                    console.log(lives);
                    playerXpos = 0;

                    if (lives < 0) {
                        gameRunning = false;
                    }

                }


            });


        }

        function textRender(text, c, x, y, font) {
            canvasContext.fillStyle = c;
            canvasContext.font = font;
            canvasContext.fillText(text, x, y);

        }
    }

    </script>
</body>

</html>
